const optionsSection=document.querySelector(".main__options"),mobileMenuButton=document.querySelector(".mobile-menu-btn");function mobileMenu(){optionsSection.classList.toggle("active-menu"),mobileMenuButton.classList.toggle("active-menu-btn")}mobileMenuButton&&mobileMenuButton.addEventListener("click",mobileMenu);const apiKey="98b3e8ec96b066ca74e2cdfdcad1a2fe";let city="Warsaw";const apiUrl=(e,t)=>"https://api.openweathermap.org/data/2.5/forecast?q="+e+"&units=metric&appid="+t;let temperatureUnit,windSpeedUnit="km/h";const loadingOverlay=document.querySelector(".loading-overlay");let mainIndex=0;function returnActualTemperatureUnit(){return localStorage.getItem("temperature-unit")?localStorage.getItem("temperature-unit"):"C"}function returnActualWindSpeedUnit(){return localStorage.getItem("wind-speed-unit")?localStorage.getItem("wind-speed-unit"):"m/s"}function returnActualCity(){return localStorage.getItem("city")?localStorage.getItem("city"):"Warsaw"}function sendAndFetchApiRequest(e,t,i,n){fetch(apiUrl(e,apiKey)).then(e=>e.json()).then(e=>{useApiData(e,t,i,n)}).catch(e=>{console.error("There was a problem with the fetch operation:",e)})}function useApiData(e,t,i,n){var o=setBackgroundAndIcon(e,t),r=setMainInformation(e,t,i,n),e=setDailyForecast(e,t,i,n);Promise.all([o,r,e]).then(()=>{setTimeout(()=>{loadingOverlay.classList.add("loading-overlay-nodisplay")},100),drawCanvasGraph(),setDailyForecastElementsPosition()}).catch(e=>{console.error("An error occurred:",e),setTimeout(()=>{loadingOverlay.classList.add("loading-overlay-nodisplay")},100)})}function setMainInformation(m,p,h,w){return new Promise(e=>{var t=document.querySelector(".header__info__city__name"),i=document.querySelector(".header__info__weather-description"),n=document.querySelector(".header__info__temperature"),o=document.querySelector(".header__info__day__week-day"),r=document.querySelector(".header__info__day__date"),s=document.querySelector(".header__info__day__time"),a=document.querySelector(".main__weekly-and-air__weekly__days__choosen-day__week-day-name"),c=document.querySelector(".main__weekly-and-air__weekly__time__text"),l=document.querySelector(".real-feel-value"),d=document.querySelector(".wind-speed-value"),u=document.querySelector(".humidity-value");t.innerText=m.city.name,i.innerText=m.list[p].weather[0].description.toUpperCase(),n.innerText=returnTempreatureValueInChoosenUnit(m.list[p].main.temp,h),o.innerText=getDayOfWeekWithTimezone(m.list[p].dt_txt,m.city.timezone),r.innerText=formatDateWithTimezone(m.list[p].dt_txt,m.city.timezone),s.innerText=extractTimeWithTimezone(m.list[p].dt_txt,m.city.timezone),a.innerText=getDayOfWeekWithTimezone(m.list[p].dt_txt,m.city.timezone).substring(0,3).toUpperCase(),c.innerText=extractTimeWithTimezone(m.list[p].dt_txt,m.city.timezone),l.innerText=returnTempreatureValueInChoosenUnit(m.list[p].main.feels_like,h),d.innerText=returnWindSpeedInChoosenUnit(m.list[p].wind.speed,w),u.innerText=m.list[p].main.humidity+"%",e()})}function setBackgroundAndIcon(s,a){return new Promise(e=>{var t=document.querySelector(".bg-photo"),i=document.querySelector(".big-icon-photo-mobile"),n=document.querySelector(".big-icon-photo-desktop"),o=document.querySelector(".weather-small-icon"),r=s.list[a].weather[0].main;"Clear"===r?(t.src="img/background-images/clear.webp",t.alt="clear;",i.src="img/weather-icon-images/clear.svg",i.alt="clear",n.src="img/weather-icon-images/clear.svg",n.alt="clear",o.src="img/weather-icon-images/clear.svg",o.alt="clear"):"Clouds"===r?(t.src="img/background-images/clouds.webp",t.alt="clouds",i.src="img/weather-icon-images/clouds.svg",i.alt="clouds",n.src="img/weather-icon-images/clouds.svg",n.alt="clouds",o.src="img/weather-icon-images/clouds.svg",o.alt="clouds"):"Rain"===r?(t.src="img/background-images/rain.webp",t.alt="rain",i.src="img/weather-icon-images/rain.svg",i.alt="rain",n.src="img/weather-icon-images/rain.svg",n.alt="rain",o.src="img/weather-icon-images/rain.svg",o.alt="rain"):"Snow"===r&&(t.src="img/background-images/snow.webp",t.alt="snow",i.src="img/weather-icon-images/snow.svg",i.alt="snow",n.src="img/weather-icon-images/snow.svg",n.alt="snow",o.src="img/weather-icon-images/snow.svg",o.alt="snow"),e()})}function setDailyForecast(a,c,l,d){return new Promise(e=>{var t=document.querySelectorAll(".main__daily-forecast__graph__element"),i=document.querySelectorAll(".main__daily-forecast__graph__element__temperature"),n=document.querySelectorAll(".daily-forecast-element-icon"),o=document.querySelectorAll(".main__daily-forecast__graph__element__icon__wind"),r=document.querySelectorAll(".main__daily-forecast__graph__element__icon__time");for(let e=0;e<t.length;e++){i[e].innerText=returnTempreatureValueInChoosenUnit(a.list[e+c].main.temp,l);var s=a.list[e+c].weather[0].main;"Clear"===s?(n[e].src="/img/weather-icon-images/clear.svg",n[e].alt="clear"):"Clouds"===s?(n[e].src="/img/weather-icon-images/clouds.svg",n[e].alt="clouds"):"Rain"===s?(n[e].src="/img/weather-icon-images/rain.svg",n[e].alt="rain"):"Snow"===s&&(n[e].src="/img/weather-icon-images/snow.svg",n[e].alt="snow"),o[e].innerText=returnWindSpeedInChoosenUnit(a.list[e+c].wind.speed,d),r[e].innerText=extractTimeWithTimezone(a.list[e+c].dt_txt,a.city.timezone)}e()})}function setDailyForecastElementsPosition(){var t=document.querySelectorAll(".main__daily-forecast__graph__element"),i=document.querySelectorAll(".main__daily-forecast__graph__element__temperature");let n=-1/0,o=1/0,r=0;for(let e=0;e<t.length;e++){var s=parseInt(i[e].innerText);r+=s,s<o&&(o=s),s>n&&(n=s)}const a=10/(n-o);var c;r,t.length;for(let e=0;e<t.length;e++){const l=parseInt(i[e].innerText);l===n?(t[e].style.transform="translateY(-5rem)",t[e].dataset.transformValue=-5):l===o?(t[e].style.transform="translateY(5rem)",t[e].dataset.transformValue=5):(c=()=>{return 5-(l-o)*a},t[e].style.transform=`translateY(${c()}rem)`,t[e].dataset.transformValue=c())}changeElementsPositionInDailyWeatherOnMobile()}function returnTempreatureValueInChoosenUnit(e,t){return"C"==t?Math.round(e)+"°C":"F"==t?Math.round(1.8*e+32)+"°F":"K"==t?Math.round(e+273.15)+"K":void 0}function returnWindSpeedInChoosenUnit(e,t){return"m/s"===t?e.toFixed(1)+"m/s":"km/h"===t?(3.6*e).toFixed(1)+"km/h":"M/h"===t?(2.2*e).toFixed(1)+"M/h":void 0}function getDayOfWeekWithTimezone(e,t){e=new Date(e),e.setSeconds(e.getSeconds()+t+-7200),t=e.getDay();return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t]}function formatDateWithTimezone(e,t){e=new Date(e),e.setSeconds(e.getSeconds()+t+-7200),t=`${e.getDate()} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]} `+e.getFullYear();return t}function extractTimeWithTimezone(e,t){e=new Date(e),e.setSeconds(e.getSeconds()+t+-7200),t=String(e.getHours()).padStart(2,"0");return t+":"+String(e.getMinutes()).padStart(2,"0")}function changeElementsPositionInDailyWeatherOnMobile(){window.innerWidth<960?document.querySelectorAll(".main__daily-forecast__graph__element").forEach(e=>{e.style.transform=`translateY(${e.dataset.transformValue/2}rem)`}):document.querySelectorAll(".main__daily-forecast__graph__element").forEach(e=>{e.style.transform=`translateY(${e.dataset.transformValue}rem)`})}function drawCanvasGraph(){var e=document.querySelector(".my-canvas"),t=e.getContext("2d"),i=(t.clearRect(0,0,e.width,e.height),document.querySelectorAll(".main__daily-forecast__graph__element__temperature"));let n=[];for(let e=0;e<i.length;e++)n.push({x:e,y:0});let o=-1/0,r=1/0;for(let e=0;e<i.length;e++){var s=parseInt(i[e].innerText);s<r&&(r=s),s>o&&(o=s)}var a=100/(o-r);for(let e=0;e<i.length;e++)parseInt(i[e].innerText)==o?n[e].y=100:parseInt(i[e].innerText)==r?n[e].y=0:n[e].y=(parseInt(i[e].innerText)-r)*a;const c=e.width-40,l=e.height-40;function d(e,t){return{x:e/(n.length-1)*c+20,y:l-t/100*l+20}}t.beginPath(),t.strokeStyle="white",t.lineWidth=2;e=d(n[0].x,n[0].y);t.moveTo(e.x,e.y);for(let e=1;e<n.length;e++){var u=d(n[e-1].x,n[e-1].y),m=d(n[e].x,n[e].y),p={x:(u.x+m.x)/2,y:u.y},u={x:(u.x+m.x)/2,y:m.y};t.bezierCurveTo(p.x,p.y,u.x,u.y,m.x,m.y)}t.stroke()}window.addEventListener("resize",changeElementsPositionInDailyWeatherOnMobile),sendAndFetchApiRequest(returnActualCity(),mainIndex,returnActualTemperatureUnit(),returnActualWindSpeedUnit());const sliderLeftArrow=document.querySelector(".main__weekly-and-air__weekly__days__left-arrow"),sliderRightArrow=document.querySelector(".main__weekly-and-air__weekly__days__right-arrow");function rightArrowService(){32!=mainIndex&&(mainIndex+=8,sendAndFetchApiRequest(returnActualCity(),mainIndex,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow.classList.contains("arrow-blocked")&&sliderLeftArrow.classList.remove("arrow-blocked"),32==mainIndex)&&sliderRightArrow.classList.add("arrow-blocked")}function leftArrowService(){0!=mainIndex&&(mainIndex-=8,sendAndFetchApiRequest(returnActualCity(),mainIndex,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderRightArrow.classList.contains("arrow-blocked")&&sliderRightArrow.classList.remove("arrow-blocked"),0==mainIndex)&&sliderLeftArrow.classList.add("arrow-blocked")}sliderRightArrow&&sliderRightArrow.addEventListener("click",rightArrowService),sliderLeftArrow&&sliderLeftArrow.addEventListener("click",leftArrowService);const optionsClosingButton=document.querySelector(".options-window__wrapper__closing-button"),optionsButton=document.querySelector(".main__options__settings"),optionsWindow=document.querySelector(".options-window"),optionsUnderOverlay=document.querySelector(".options-under-overlay"),optionsChoiceCelsius=document.querySelector(".choice-celsius"),optionsChoiceFahrenheit=document.querySelector(".choice-fahrenheit"),optionsChoiceKelvin=document.querySelector(".choice-kelvin"),optionsChoiceMetresPerSecond=document.querySelector(".choice-metres-per-second"),optionsChoiceKilometresPerHour=document.querySelector(".choice-kilometres-per-hour"),optionsChoiceMilesPerHour=document.querySelector(".choice-miles-per-hour");function closeOptionsWindow(){optionsWindow&&optionsWindow.classList.add("options-window-nodisplay"),optionsUnderOverlay&&optionsUnderOverlay.classList.add("options-window-nodisplay")}function openOptionsWindow(){optionsWindow&&optionsWindow.classList.remove("options-window-nodisplay"),optionsUnderOverlay&&optionsUnderOverlay.classList.remove("options-window-nodisplay")}function setingTemperatureUnitInLocalStorage(){optionsChoiceCelsius&&optionsChoiceCelsius.addEventListener("click",()=>{localStorage.setItem("temperature-unit","C"),setActiveOnActualTemperatureButton(),sendAndFetchApiRequest(city,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0}),optionsChoiceFahrenheit&&optionsChoiceFahrenheit.addEventListener("click",()=>{localStorage.setItem("temperature-unit","F"),setActiveOnActualTemperatureButton(),sendAndFetchApiRequest(city,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0}),optionsChoiceKelvin&&optionsChoiceKelvin.addEventListener("click",()=>{localStorage.setItem("temperature-unit","K"),setActiveOnActualTemperatureButton(),sendAndFetchApiRequest(city,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0})}function setActiveOnActualTemperatureButton(){var e=localStorage.getItem("temperature-unit");!e||"C"==e?(optionsChoiceFahrenheit.classList.remove("options-element-active"),optionsChoiceKelvin.classList.remove("options-element-active"),optionsChoiceCelsius.classList.add("options-element-active")):"F"==e?(optionsChoiceCelsius.classList.remove("options-element-active"),optionsChoiceKelvin.classList.remove("options-element-active"),optionsChoiceFahrenheit.classList.add("options-element-active")):"K"==e&&(optionsChoiceCelsius.classList.remove("options-element-active"),optionsChoiceFahrenheit.classList.remove("options-element-active"),optionsChoiceKelvin.classList.add("options-element-active"))}function setActiveOnActualWindSpeedButton(){var e=localStorage.getItem("wind-speed-unit");!e||"m/s"==e?(optionsChoiceMetresPerSecond.classList.add("options-element-active"),optionsChoiceKilometresPerHour.classList.remove("options-element-active"),optionsChoiceMilesPerHour.classList.remove("options-element-active")):"km/h"==e?(optionsChoiceMetresPerSecond.classList.remove("options-element-active"),optionsChoiceKilometresPerHour.classList.add("options-element-active"),optionsChoiceMilesPerHour.classList.remove("options-element-active")):"M/h"==e&&(optionsChoiceMetresPerSecond.classList.remove("options-element-active"),optionsChoiceKilometresPerHour.classList.remove("options-element-active"),optionsChoiceMilesPerHour.classList.add("options-element-active"))}function setingWindSpeedUnitInLocalStorage(){optionsChoiceMetresPerSecond&&optionsChoiceMetresPerSecond.addEventListener("click",()=>{localStorage.setItem("wind-speed-unit","m/s"),setActiveOnActualWindSpeedButton(),sendAndFetchApiRequest(city,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0}),optionsChoiceKilometresPerHour&&optionsChoiceKilometresPerHour.addEventListener("click",()=>{localStorage.setItem("wind-speed-unit","km/h"),setActiveOnActualWindSpeedButton(),sendAndFetchApiRequest(city,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0}),optionsChoiceMilesPerHour&&optionsChoiceMilesPerHour.addEventListener("click",()=>{localStorage.setItem("wind-speed-unit","M/h"),setActiveOnActualWindSpeedButton(),sendAndFetchApiRequest(city,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0})}optionsClosingButton&&optionsClosingButton.addEventListener("click",closeOptionsWindow),optionsButton&&optionsButton.addEventListener("click",openOptionsWindow),optionsUnderOverlay&&optionsUnderOverlay.addEventListener("click",closeOptionsWindow),setingTemperatureUnitInLocalStorage(),setingWindSpeedUnitInLocalStorage(),setActiveOnActualTemperatureButton(),setActiveOnActualWindSpeedButton();const citiesChoiceWindow=document.querySelector(".cities-choice"),citiesChoiceElements=document.querySelectorAll(".cities-choice__element"),citiesUnderOverlay=document.querySelector(".options-under-overlay"),citiesChoiceButton=document.querySelector(".main__options__cities");function cityChoosing(e){citiesChoiceWindow&&citiesChoiceWindow.classList.add("options-window-nodisplay"),citiesUnderOverlay&&citiesUnderOverlay.classList.add("options-window-nodisplay"),localStorage.setItem("city",e.dataset.cityName),sendAndFetchApiRequest(e.dataset.cityName,0,returnActualTemperatureUnit(),returnActualWindSpeedUnit()),sliderLeftArrow&&sliderLeftArrow.classList.add("arrow-blocked"),sliderRightArrow&&sliderRightArrow.classList.remove("arrow-blocked"),mainIndex=0}citiesChoiceElements&&citiesChoiceElements.forEach(e=>{e.addEventListener("click",()=>{cityChoosing(e)})}),citiesUnderOverlay&&citiesUnderOverlay.addEventListener("click",()=>{citiesUnderOverlay.classList.add("options-window-nodisplay"),citiesChoiceWindow&&citiesChoiceWindow.classList.add("options-window-nodisplay")}),citiesChoiceButton&&citiesChoiceButton.addEventListener("click",()=>{citiesUnderOverlay&&citiesUnderOverlay.classList.remove("options-window-nodisplay"),citiesChoiceWindow&&citiesChoiceWindow.classList.remove("options-window-nodisplay")});